<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>release_pipeline_dr &mdash; boomi-cicd-cli-py 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="environment_extensions_update" href="environment-extensions-update.html" />
    <link rel="prev" title="release_pipeline" href="release-pipeline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            boomi-cicd-cli-py
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="example-cicd-scripts.html">Example CICD Scripts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="release-pipeline.html">release_pipeline</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">release_pipeline_dr</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#required-environment-variables">Required Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-arguments">Command Line Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#release-json-file">Release JSON File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="environment-extensions-update.html">environment_extensions_update</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines/release-pipeline-configuration.html">Release Pipeline Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules.html">Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">boomi-cicd-cli-py</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="example-cicd-scripts.html">Example CICD Scripts</a></li>
      <li class="breadcrumb-item active">release_pipeline_dr</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example-scripts/release-pipeline-dr.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="release-pipeline-dr">
<span id="id1"></span><h1>release_pipeline_dr<a class="headerlink" href="#release-pipeline-dr" title="Permalink to this heading"></a></h1>
<p>The release_pipeline script is an example of how to perform a DR failover for two atoms within a single Boomi Environment and with an active-active DR configuration. The script will turn off schedules and listeners in the atom that is down and turn on schedules and listeners on the other atom. When the down atom come back online, it will initially sync with the Boomi platform and the action to turn off schedules and listeners will occur then. The script will loop through the release file that is used within the release_pipeline script. That way, the same processes that are deployed during the initial release will failover.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">boomi_cicd</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">boomi_cicd.util.atom</span> <span class="kn">import</span> <span class="n">query_atom</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">boomi_cicd.util.change_listener_status</span> <span class="kn">import</span> <span class="n">change_listener_status</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">boomi_cicd.util.common_util</span> <span class="kn">import</span> <span class="n">set_release</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">boomi_cicd.util.process_schedule_status</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 6</span>    <span class="n">query_process_schedule_status</span><span class="p">,</span>
<span class="linenos"> 7</span>    <span class="n">update_process_schedule_status</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c1"># This script is used to turn off listener and batch schedules in primary atom and on in DR</span>
<span class="linenos">11</span><span class="c1"># The atoms are set up in an active-active configuration within the same environment</span>
<span class="linenos">12</span><span class="c1"># No persisted properties are being used on the primary atom</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="c1"># Open release json</span>
<span class="linenos">15</span><span class="n">releases</span> <span class="o">=</span> <span class="n">set_release</span><span class="p">()</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c1"># Get atom id</span>
<span class="linenos">18</span><span class="n">atom_id</span> <span class="o">=</span> <span class="n">query_atom</span><span class="p">(</span><span class="n">boomi_cicd</span><span class="o">.</span><span class="n">ATOM_NAME</span><span class="p">)</span>
<span class="linenos">19</span><span class="n">atom_dr_id</span> <span class="o">=</span> <span class="n">query_atom</span><span class="p">(</span><span class="n">boomi_cicd</span><span class="o">.</span><span class="n">ATOM_NAME_DR</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">for</span> <span class="n">release</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">[</span><span class="s2">&quot;pipelines&quot;</span><span class="p">]:</span>
<span class="linenos">22</span>    <span class="n">component_id</span> <span class="o">=</span> <span class="n">release</span><span class="p">[</span><span class="s2">&quot;componentId&quot;</span><span class="p">]</span>
<span class="linenos">23</span>    <span class="c1"># Turn off listener in primary and on in DR</span>
<span class="linenos">24</span>    <span class="k">if</span> <span class="s2">&quot;listenerStatus&quot;</span> <span class="ow">in</span> <span class="n">release</span><span class="p">:</span>
<span class="linenos">25</span>        <span class="n">change_listener_status</span><span class="p">(</span><span class="n">component_id</span><span class="p">,</span> <span class="n">atom_id</span><span class="p">,</span> <span class="s2">&quot;pause&quot;</span><span class="p">)</span>
<span class="linenos">26</span>        <span class="n">change_listener_status</span><span class="p">(</span><span class="n">component_id</span><span class="p">,</span> <span class="n">atom_id</span><span class="p">,</span> <span class="s2">&quot;resume&quot;</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="c1"># Pause schedules in primary and resume in DR</span>
<span class="linenos">29</span>    <span class="k">if</span> <span class="s2">&quot;schedule&quot;</span> <span class="ow">in</span> <span class="n">release</span><span class="p">:</span>
<span class="linenos">30</span>        <span class="c1"># Get conceptual id of deployed process</span>
<span class="linenos">31</span>        <span class="n">conceptual_id</span> <span class="o">=</span> <span class="n">query_process_schedule_status</span><span class="p">(</span><span class="n">atom_id</span><span class="p">,</span> <span class="n">component_id</span><span class="p">)</span>
<span class="linenos">32</span>        <span class="n">conceptual_id_dr</span> <span class="o">=</span> <span class="n">query_process_schedule_status</span><span class="p">(</span><span class="n">atom_dr_id</span><span class="p">,</span> <span class="n">component_id</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span>        <span class="n">update_process_schedule_status</span><span class="p">(</span><span class="n">component_id</span><span class="p">,</span> <span class="n">conceptual_id</span><span class="p">,</span> <span class="n">atom_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">35</span>        <span class="n">update_process_schedule_status</span><span class="p">(</span><span class="n">component_id</span><span class="p">,</span> <span class="n">conceptual_id_dr</span><span class="p">,</span> <span class="n">atom_dr_id</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<section id="required-environment-variables">
<h2>Required Environment Variables<a class="headerlink" href="#required-environment-variables" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Environment Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BOOMI_ACCOUNT_ID</p></td>
<td><p>The Boomi account ID.</p></td>
</tr>
<tr class="row-odd"><td><p>BOOMI_ATOM_NAME</p></td>
<td><p>The name of the Boomi Atom.</p></td>
</tr>
<tr class="row-even"><td><p>BOOMI_ATOM_NAME_DR</p></td>
<td><p>The name of the Boomi Atom.</p></td>
</tr>
<tr class="row-odd"><td><p>BOOMI_BASE_URL</p></td>
<td><p>The base URL for the Boomi API. <a class="reference external" href="https://api.boomi.com/api/rest/v1">https://api.boomi.com/api/rest/v1</a></p></td>
</tr>
<tr class="row-even"><td><p>BOOMI_CLI_BASE_DIR</p></td>
<td><p>The base directory for the Boomi CLI.</p></td>
</tr>
<tr class="row-odd"><td><p>BOOMI_PASSWORD</p></td>
<td><p>The Boomi password. Atomsphere API Token is recommended</p></td>
</tr>
<tr class="row-even"><td><p>BOOMI_RELEASE_BASE_DIR</p></td>
<td><p>The base directory for the release JSON file.</p></td>
</tr>
<tr class="row-odd"><td><p>BOOMI_RELEASE_FILE</p></td>
<td><p>The name of the release JSON file to use.</p></td>
</tr>
<tr class="row-even"><td><p>BOOMI_USERNAME</p></td>
<td><p>The Boomi username. Atomsphere API Token is recommended</p></td>
</tr>
</tbody>
</table>
</section>
<section id="command-line-arguments">
<h2>Command Line Arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>-r, –release_file: The release JSON file to use. If not specified, then the BOOMI_RELEASE_FILE environment variable
will be used.</p></li>
</ul>
</section>
<section id="release-json-file">
<h2>Release JSON File<a class="headerlink" href="#release-json-file" title="Permalink to this heading"></a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;pipelines&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">      </span><span class="nt">&quot;processName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;An Example Batch Process&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">      </span><span class="nt">&quot;packageVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">      </span><span class="nt">&quot;componentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;83d6013f-96f5-4a75-a97b-f4934b0ec2e8&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an example set of notes&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">      </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 1 * * * ; 30 0 2-7 * * *&quot;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">10</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">      </span><span class="nt">&quot;processName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;An Example Listener Process&quot;</span><span class="p">,</span>
<span class="linenos">12</span><span class="w">      </span><span class="nt">&quot;packageVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">&quot;componentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b24f310b-6a66-4e0d-97a3-26f1e812b79a&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">      </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an example set of notes&quot;</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">      </span><span class="nt">&quot;listenerStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RUNNING&quot;</span>
<span class="linenos">16</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">17</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">18</span><span class="w">      </span><span class="nt">&quot;processName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;An Example Custom Library&quot;</span><span class="p">,</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">&quot;componentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7bd40730-6df3-4ba9-b4b2-ed9153dbca6d&quot;</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">&quot;packageVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">      </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Initial deployment&quot;</span>
<span class="linenos">22</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">23</span><span class="w">  </span><span class="p">]</span>
<span class="linenos">24</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="release-pipeline.html" class="btn btn-neutral float-left" title="release_pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="environment-extensions-update.html" class="btn btn-neutral float-right" title="environment_extensions_update" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Boomi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>